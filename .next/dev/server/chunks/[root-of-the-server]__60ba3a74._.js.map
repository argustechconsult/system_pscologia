{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///home/jhon/Desktop/ALURA/argus/projetos_landinpages/system_pscologia/pages/api/generate-message.ts"],"sourcesContent":["\nimport { GoogleGenAI } from \"@google/genai\";\nimport type { NextApiRequest, NextApiResponse } from 'next';\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  const apiKey = process.env.API_KEY;\n  if (!apiKey) {\n    return res.status(500).json({ error: 'API_KEY not configured' });\n  }\n\n  const { type, clientName, lastSession, date, time, meetLink } = req.body;\n  \n  const ai = new GoogleGenAI({ apiKey });\n\n  let prompt = '';\n  // Default values for fallback\n  const fallbackRetention = `Olá ${clientName}, como você está? Notei que faz um tempo que não nos vemos. Gostaria de saber se está tudo bem e se gostaria de agendar um novo horário. Abraços, Soraia.`;\n  const fallbackConfirmation = `Olá ${clientName}, sua consulta com a Dra. Soraia está confirmada para ${date} às ${time}. Link: ${meetLink}. Até lá!`;\n  \n  let fallbackMessage = '';\n\n  if (type === 'retention') {\n    prompt = `Escreva uma mensagem curta, acolhedora e profissional para o WhatsApp/Email de um paciente chamado ${clientName} que não comparece a uma sessão desde ${lastSession || 'algum tempo'}. O objetivo é demonstrar preocupação com o bem-estar dele e oferecer uma nova consulta de forma gentil, sem pressionar. A profissional é Soraia, Psicóloga Clínica e Neuropsicóloga. Mantenha o tom empático.`;\n    fallbackMessage = fallbackRetention;\n  } else if (type === 'confirmation') {\n    prompt = `Escreva uma mensagem de confirmação de agendamento de consulta para o paciente ${clientName}. \n    Data: ${date} às ${time}. \n    Link da sessão: ${meetLink}. \n    A profissional é Soraia, Psicóloga Clínica e Neuropsicóloga. \n    A mensagem deve ser profissional, acolhedora e instruir o paciente a clicar no link no horário da sessão.`;\n    fallbackMessage = fallbackConfirmation;\n  } else {\n    return res.status(400).json({ error: 'Invalid type' });\n  }\n\n  try {\n    const response = await ai.models.generateContent({\n      model: 'gemini-2.0-flash-exp',\n      contents: prompt,\n    });\n    // @ts-ignore - The SDK returns text as property or function depending on version, treating as any to be safe or assuming property based on lint\n    const text = typeof response.text === 'function' ? response.text() : response.text;\n    return res.status(200).json({ text: text });\n  } catch (error) {\n    console.error(\"Gemini API Error (Using Fallback):\", error);\n    // Return fallback message with 200 OK so frontend handles it gracefully\n    return res.status(200).json({ text: fallbackMessage });\n  }\n}\n"],"names":[],"mappings":";;;;AACA;;;;;;AAGe,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D;IAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO;IAClC,IAAI,CAAC,QAAQ;QACX,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAyB;IAChE;IAEA,MAAM,EAAE,IAAI,EAAE,UAAU,EAAE,WAAW,EAAE,IAAI,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI;IAExE,MAAM,KAAK,IAAI,yMAAW,CAAC;QAAE;IAAO;IAEpC,IAAI,SAAS;IACb,8BAA8B;IAC9B,MAAM,oBAAoB,CAAC,IAAI,EAAE,WAAW,yJAAyJ,CAAC;IACtM,MAAM,uBAAuB,CAAC,IAAI,EAAE,WAAW,sDAAsD,EAAE,KAAK,IAAI,EAAE,KAAK,QAAQ,EAAE,SAAS,SAAS,CAAC;IAEpJ,IAAI,kBAAkB;IAEtB,IAAI,SAAS,aAAa;QACxB,SAAS,CAAC,mGAAmG,EAAE,WAAW,sCAAsC,EAAE,eAAe,cAAc,8MAA8M,CAAC;QAC9Y,kBAAkB;IACpB,OAAO,IAAI,SAAS,gBAAgB;QAClC,SAAS,CAAC,+EAA+E,EAAE,WAAW;UAChG,EAAE,KAAK,IAAI,EAAE,KAAK;oBACR,EAAE,SAAS;;6GAE8E,CAAC;QAC1G,kBAAkB;IACpB,OAAO;QACL,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAe;IACtD;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,GAAG,MAAM,CAAC,eAAe,CAAC;YAC/C,OAAO;YACP,UAAU;QACZ;QACA,gJAAgJ;QAChJ,MAAM,OAAO,OAAO,SAAS,IAAI,KAAK,aAAa,SAAS,IAAI,KAAK,SAAS,IAAI;QAClF,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,MAAM;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,wEAAwE;QACxE,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,MAAM;QAAgB;IACtD;AACF"}}]
}